{% extends "base/layout.html" %}

{% block title %}{{ product.name }} ‚Äî ShopFlask{% endblock %}

{% block content %}

<a href="{{ url_for('products.listing', category=product.category.slug) }}"
   style="font-size:.82rem; color:var(--clr-text-sm); display:inline-block; margin-bottom:1rem;">
  ‚Üê Back to {{ product.category.name }}
</a>

<div class="detail-layout">

  <!-- Image -->
  <div class="detail-img-wrap">
    {% if product.image_url %}
      <img src="{{ product.image_url }}" alt="{{ product.name }}" />
    {% else %}
      <span class="detail-img-placeholder">üõçÔ∏è</span>
    {% endif %}
  </div>

  <!-- Info -->
  <div class="detail-info">
    <span class="detail-category">{{ product.category.name }}</span>
    <h1>{{ product.name }}</h1>
    <span class="detail-price">{{ product.price_display }}</span>

    <p class="detail-desc">{{ product.description }}</p>

    <div class="detail-stock">
      {% if product.in_stock %}
        <span class="detail-stock--on">‚úì In Stock ({{ product.stock }} left)</span>
      {% else %}
        <span class="detail-stock--off">‚úó Out of Stock</span>
      {% endif %}
    </div>

    {% if product.in_stock and current_user.is_authenticated %}
      <form method="POST" action="{{ url_for('cart.add_item', product_id=product.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="qty-selector">
          <label>Qty</label>
          <!-- Quantity is handled server-side; each "Add" increments by 1 -->
        </div>
        <button type="submit" class="btn btn-accent">Add to Cart</button>
      </form>
    {% elif not current_user.is_authenticated %}
      <a href="{{ url_for('auth.login', next=request.path) }}" class="btn btn-outline">
        Log in to add to cart
      </a>
    {% else %}
      <button class="btn btn-outline" disabled>Out of Stock</button>
    {% endif %}
  </div>
</div>

{% endblock %}
